---
layout: post
title: LLVM vs Dalvik (Android) note II 
tag: LLVM 
categories: compiler
---

Dalvik is the process virtual machine in Google's _Android_ operating system. As we all known, Andorid right now is the most popular mobile platform. 

#####Differences
1. _Code generation_ , Bitcode can be translated to native code by LLVM and during the process it also can call Native lib and be excuted by cpu. But for Dalvik ByteCode, it must be excuted under Dalvik VM. Even with Dalvik JIT compiler, there is only small part of Dalvik ByteCode TraceRun module can be translated to the native assembly. It is not like the native code generated by LLVM can be excuted 100% in native environment.

2. _Reuseability_ , LLVM can optimize BitCode into native code entirely. Now, Dalvik ByteCode only support runtime ByteCode JIT compiler. Once Dalvik program exits, all JIT compiled results are gone. It needs the Dalvik program be reloaded and then decide which part to be translated into native code by every ByteCode Trace-Run's counter.

3. _Space_ , Usually, Dalvik application APK nees 2 storage space, one for DEX , one for ODEX that stays in dalvik cache. But LLVM application don't need to do that.

4. _Computing Resource_ , The result from LLVM compiler can be excuted in a native way but Dalvik JIT needs Trace-Run Counter to decide recompiling. So from cpu runtim overhead, LLVM is more efficient.

5. _Security_, LLVM suport inline assembly which is not allowed in Java world. This makes LLVM efficient but also some security problem around this.

####Dalvik Compiling 
<img src="/assets/images/LLVM2.png" alt="Dalvik" title="Dalvik" width="90%" />

####LLVM Compiling
<img src="/assets/images/LLVM3.png" alt="LLVM" title="LLVM" width="90%" />
